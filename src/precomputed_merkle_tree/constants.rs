use std::collections::HashMap;
use std::sync::OnceLock;

/// The roots of the precomputed Merkle trees.
pub static PRECOMPUTED_MERKLE_TREE_ROOTS: OnceLock<HashMap<u32, [u8; 32]>> = OnceLock::new();

/// Initialize the precomputed Merkle tree roots.
pub fn get_precomputed_merkle_tree_roots() -> HashMap<u32, [u8; 32]> {
    let mut res = HashMap::new();

    res.insert(
        4,
        [
            231, 144, 123, 222, 58, 66, 185, 199, 116, 15, 172, 3, 176, 125, 11, 158, 168, 238,
            155, 206, 213, 142, 109, 9, 112, 116, 204, 41, 52, 159, 235, 134,
        ],
    );
    res.insert(
        12,
        [
            96, 60, 60, 239, 193, 96, 134, 30, 246, 227, 100, 10, 64, 12, 225, 225, 137, 211, 111,
            19, 199, 5, 140, 8, 223, 89, 150, 224, 255, 6, 105, 117,
        ],
    );
    res.insert(
        13,
        [
            48, 191, 94, 233, 158, 192, 71, 235, 116, 94, 60, 190, 153, 68, 129, 93, 61, 225, 14,
            4, 83, 230, 25, 225, 179, 35, 174, 158, 217, 74, 236, 83,
        ],
    );
    res.insert(
        14,
        [
            155, 147, 180, 234, 252, 169, 133, 216, 66, 152, 2, 173, 128, 236, 211, 18, 73, 91, 55,
            132, 135, 47, 94, 35, 39, 44, 213, 108, 203, 98, 136, 73,
        ],
    );
    res.insert(
        15,
        [
            87, 140, 12, 254, 244, 136, 60, 205, 245, 171, 35, 176, 119, 174, 150, 24, 13, 89, 55,
            80, 247, 215, 223, 149, 38, 55, 224, 0, 189, 233, 253, 67,
        ],
    );
    res.insert(
        16,
        [
            70, 131, 130, 64, 168, 80, 210, 6, 101, 172, 15, 138, 184, 207, 45, 240, 148, 2, 217,
            199, 206, 35, 85, 0, 188, 3, 54, 202, 139, 57, 230, 35,
        ],
    );
    res.insert(
        17,
        [
            120, 79, 6, 246, 122, 80, 13, 45, 183, 95, 74, 46, 255, 66, 107, 211, 146, 229, 73,
            178, 246, 29, 253, 79, 214, 226, 134, 233, 148, 15, 4, 149,
        ],
    );
    res.insert(
        18,
        [
            125, 199, 154, 70, 203, 117, 185, 89, 195, 119, 251, 46, 240, 110, 23, 202, 109, 151,
            33, 175, 154, 30, 32, 227, 166, 225, 133, 164, 171, 153, 232, 16,
        ],
    );
    res.insert(
        19,
        [
            164, 158, 72, 142, 216, 151, 188, 44, 243, 73, 165, 150, 178, 3, 116, 104, 35, 172, 60,
            140, 219, 191, 184, 221, 176, 248, 196, 180, 166, 86, 201, 6,
        ],
    );
    res.insert(
        20,
        [
            178, 116, 29, 246, 95, 225, 244, 247, 101, 253, 169, 224, 9, 127, 201, 56, 102, 212,
            24, 52, 107, 26, 170, 31, 18, 232, 96, 37, 166, 167, 255, 236,
        ],
    );
    res.insert(
        21,
        [
            121, 33, 193, 38, 72, 252, 29, 96, 30, 130, 20, 171, 88, 164, 74, 154, 1, 60, 139, 93,
            177, 119, 120, 142, 16, 126, 89, 99, 212, 204, 123, 179,
        ],
    );
    res.insert(
        22,
        [
            100, 214, 176, 19, 61, 16, 199, 86, 124, 78, 162, 228, 7, 149, 167, 226, 49, 41, 136,
            121, 252, 158, 62, 180, 208, 192, 85, 99, 175, 244, 184, 155,
        ],
    );
    res.insert(
        23,
        [
            30, 60, 44, 177, 88, 132, 16, 84, 188, 116, 251, 173, 114, 186, 17, 97, 121, 142, 51,
            243, 179, 207, 232, 73, 187, 238, 21, 45, 239, 18, 197, 156,
        ],
    );
    res.insert(
        24,
        [
            201, 49, 176, 116, 62, 116, 45, 103, 254, 237, 126, 162, 157, 190, 4, 110, 120, 247,
            134, 215, 188, 154, 88, 82, 214, 159, 27, 134, 146, 90, 130, 232,
        ],
    );
    res.insert(
        25,
        [
            166, 183, 231, 13, 133, 69, 132, 158, 30, 74, 222, 159, 167, 108, 10, 198, 219, 198,
            147, 130, 138, 31, 25, 79, 207, 36, 166, 118, 180, 134, 53, 78,
        ],
    );

    res
}

#[cfg(test)]
mod test {
    use crate::precomputed_merkle_tree::*;

    #[test]
    fn test_consistency() {
        let roots = PRECOMPUTED_MERKLE_TREE_ROOTS.get_or_init(get_precomputed_merkle_tree_roots);

        // unit tests are running until 18.
        for i in 12..=18 {
            assert_eq!(
                PrecomputedMerkleTree::new(i).root_hash,
                *roots.get(&(i as u32)).unwrap()
            );
        }
    }
}
